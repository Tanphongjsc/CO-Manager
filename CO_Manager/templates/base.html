<!DOCTYPE html>
{% load static %}
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Hệ thống quản lý{% endblock %}</title>
    
    <!-- Thêm script kiểm tra trạng thái sidebar trước khi tải trang -->
    <script>
        // Thêm class vào body ngay từ đầu để tránh hiệu ứng nhấp nháy
        (function() {
            if (localStorage.getItem('sidebarCollapsed') === 'true') {
                document.documentElement.classList.add('sidebar-collapsed');
            }
        })();
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% block css %}{% endblock %}
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </div>
        <div class="sidebar-header">
            <h1>Hệ thống quản lý</h1>
        </div>
        <nav class="sidebar-nav">
            <a href="{% url 'index' %}" class="nav-item" data-module="dashboard">
                <i class="fas fa-layer-group"></i>
                <span>Tổng quan</span>
            </a>
            <a href="{% url 'orders' %}" class="nav-item" data-module="orders">
                <i class="fas fa-shopping-cart"></i>
                <span>Đơn hàng</span>
            </a>
            <a href="{% url 'rollback' %}" class="nav-item" data-module="rollback">
                <i class="fas fa-undo-alt"></i>
                <span>Trừ lùi nguyên liệu</span>
            </a>
            <a href="{% url 'purchase' %}" class="nav-item" data-module="purchase">
                <i class="fas fa-shopping-bag"></i>
                <span>Thu mua từ dân</span>
            </a>
            <a href="{% url 'wo_ledger' %}" class="nav-item" data-module="wo_ledger">
                <i class="fas fa-chart-line"></i>
                <span>Kê khai WO</span>
            </a>
            <a href="{% url 'ctc_ledger' %}" class="nav-item" data-module="ctc_ledger">
                <i class="fas fa-chart-bar"></i>
                <span>Kê khai CTC</span>
            </a>
            <a href="{% url 'users' %}" class="nav-item" data-module="users">
                <i class="fas fa-users"></i>
                <span>Quản lý người dùng</span>
            </a>
            <a href="{% url 'products' %}" class="nav-item" data-module="products">
                <i class="fas fa-box"></i>
                <span>Quản lý sản phẩm</span>
            </a>
        </nav>
    </div>

    <div class="main-content">
        {% block content %}
        <!-- Page specific content will be inserted here -->
        {% endblock %}
    </div>

    <script>
        // JavaScript để xử lý thu gọn/mở rộng sidebar
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            const toggleIcon = document.getElementById('toggleIcon');
            
            // Áp dụng trạng thái từ localStorage ngay khi DOMContentLoaded
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                toggleIcon.classList.remove('fa-chevron-left');
                toggleIcon.classList.add('fa-chevron-right');
                document.documentElement.classList.add('sidebar-collapsed');
            } else {
                sidebar.classList.remove('collapsed');
                toggleIcon.classList.remove('fa-chevron-right');
                toggleIcon.classList.add('fa-chevron-left');
                document.documentElement.classList.remove('sidebar-collapsed');
            }
            
            toggleBtn.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                
                // Thay đổi icon
                if (sidebar.classList.contains('collapsed')) {
                    toggleIcon.classList.remove('fa-chevron-left');
                    toggleIcon.classList.add('fa-chevron-right');
                    localStorage.setItem('sidebarCollapsed', 'true');
                    document.documentElement.classList.add('sidebar-collapsed');
                } else {
                    toggleIcon.classList.remove('fa-chevron-right');
                    toggleIcon.classList.add('fa-chevron-left');
                    localStorage.setItem('sidebarCollapsed', 'false');
                    document.documentElement.classList.remove('sidebar-collapsed');
                }
            });
        });
    </script>

    <script src="{% static 'js/base.js' %}"></script>
    {% block javascript %}{% endblock %}
</body>
</html>